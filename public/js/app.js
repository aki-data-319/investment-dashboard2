import { DashboardController } from '../../src/ui/controllers/DashboardController.js';
import { Router } from '../../src/ui/Router.js';

/**
 * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– - Phase 1.1 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆç‰ˆ
 * @description Routerã¨DashboardControllerã‚’çµ±åˆã—ãŸæ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ
 */
class App {
    constructor() {
        console.log('ğŸš€ Investment Dashboard v2 - Phase 1.1 Navigation Integration');
        this.router = null;
        this.dashboardController = null;
    }

    /**
     * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ - Routerçµ±åˆç‰ˆ
     * @description Routerä¸­å¿ƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆã§ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æä¾›
     * @returns {Promise<void>}
     */
    async start() {
        try {
            console.log('ğŸ“± Starting app with navigation...');
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
            this.updateDebugInfo('RouteråˆæœŸåŒ–ä¸­...');
            
            // RouteråˆæœŸåŒ–ï¼ˆè‡ªå‹•çš„ã«DashboardControllerã¨AssetFormControllerã‚’ç®¡ç†ï¼‰
            console.log('ğŸ§­ Initializing Router...');
            this.router = new Router();
            
            // ãƒ«ãƒ¼ã‚¿ãƒ¼åˆæœŸåŒ–å®Œäº†å¾Œã€Lucide Iconsã‚’å†åˆæœŸåŒ–
            setTimeout(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                    console.log('ğŸ”„ Lucide Icons refreshed for navigation');
                }
            }, 100);
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
            this.updateDebugInfo('Phase 1.1 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…å®Œäº† âœ…');
            
            console.log('ğŸ‰ App started successfully with navigation!');
            console.log('ğŸ“ Current routes:', this.router.getRoutes());
            
        } catch (error) {
            console.error('âŒ App startup failed:', error);
            this.updateDebugInfo(`ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }
    }

    /**
     * ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æ›´æ–°
     */
    updateDebugInfo(message) {
        const debugElement = document.getElementById('debugInfo');
        if (debugElement) {
            debugElement.textContent = message;
        }
    }
    
    /**
     * Routerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
     * @returns {Router|null} Routerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
     */
    getRouter() {
        return this.router;
    }
    
    /**
     * ç¾åœ¨ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å–å¾—ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
     * @returns {Object} ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
     */
    getNavigationState() {
        if (!this.router) return null;
        
        return {
            currentPath: this.router.getCurrentPath(),
            availableRoutes: this.router.getRoutes(),
            timestamp: new Date().toISOString()
        };
    }
}

// DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
document.addEventListener('DOMContentLoaded', async () => {
    const app = new App();
    await app.start();
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    window.app = app;
});