# 投資ダッシュボード v2 - 今後の開発方針

**作成日**: 2025年9月15日  
**対象プロジェクト**: 投資ダッシュボード v2 - BusinessLayer完成版  
**フェーズ**: Asset.js分割完了後の次期開発計画

## 📊 現在の開発状況

### ✅ 完成済みコンポーネント
- **UI Layer**: 完全実装済み
  - DashboardView.js / DashboardController.js
  - AssetFormView.js / AssetFormController.js
- **Business Layer**: 分割最適化完了
  - AssetEntity.js（定義系）
  - AssetCalculator.js（計算系）
  - AssetFormValidator.js（バリデーション）
- **Data Layer**: 実装済み
  - AssetRepository.js
  - LocalStorageAdapter.js
- **Infrastructure Layer**: 実装済み

### 🎯 実装完了度: **95%**
- 基本機能: 100% 完了
- BusinessLayer最適化: 100% 完了
- パフォーマンス最適化: 85% 完了
- テスト実装: 0% （未着手）

## 🚀 次期開発フェーズ（優先順位順）

### Phase 1: コア機能拡張・ナビゲーション実装 【優先度: 最高】

#### 1.1 ビュー間ナビゲーション実装 (Week 1)
**目標**: DashboardViewとAssetFormView間のシームレスな遷移機能

**実装項目**:
```javascript
// 新規作成予定ファイル
src/ui/router/
├── AppRouter.js              // ルーティング管理
├── NavigationController.js   // ナビゲーション制御
└── ViewManager.js            // ビュー切り替え管理

// 実装機能
- タブ式ナビゲーション（ダッシュボード ⇔ 資産追加）
- ブラウザ履歴との連携（戻る・進むボタン対応）
- ビュー間のデータ受け渡し
- 統一されたヘッダー・ナビゲーションUI
```

**技術仕様**:
- **Hash-based Routing**: `#dashboard` / `#add-asset`
- **State Management**: ビュー間のデータ共有
- **Responsive Design**: モバイル対応ナビゲーション

#### 1.1 ビュー間ナビゲーション実装（改良版） (Week 1-2)
**目標**: DashboardViewとAssetFormView間のシームレスな遷移機能

**実装項目**:
```javascript
// シンプルな統合ルーター設計
src/ui/
├── views/
│   ├── DashboardView.js          // 既存（変更なし）
│   └── AssetFormView.js          // 既存（変更なし）
├── controllers/
│   ├── DashboardController.js    // 既存（変更なし）
│   └── AssetFormController.js    // 既存（変更なし）
└── Router.js                     // 🆕 統合ルーター（1ファイル）

// 実装機能
- Hash-based ルーティング（#dashboard / #add-asset）
- タブ式ナビゲーションヘッダー
- ブラウザ履歴との連携（戻る・進むボタン対応）
- ビュー間のデータ受け渡し
- レスポンシブ対応ナビゲーション
```

**技術仕様**:
```javascript
// 統合Router設計（YAGNI原則適用）
class Router {
    constructor() {
        this.routes = new Map();
        this.controllers = new Map();
        this.currentView = null;
        
        // ルート登録（宣言的で拡張しやすい）
        this.registerRoute('dashboard', DashboardController);
        this.registerRoute('add-asset', AssetFormController);
        
        this.init();
    }
    
    // 🎯 核心機能を1つのクラスに集約
    registerRoute(path, ControllerClass) { /* ルート登録 */ }
    navigate(path, data = null) { /* プログラムによる遷移 */ }
    handleHashChange() { /* URL変更時の処理 */ }
    createNavigationUI() { /* ヘッダーナビゲーション生成 */ }
    
    // プライベートメソッドで内部実装を整理
    #showView(path, data) { /* ビュー表示処理 */ }
    #hideCurrentView() { /* 現在ビュー非表示 */ }
    #getOrCreateController(path, ControllerClass) { /* コントローラー管理 */ }
}
```

**実装方針**:
- **YAGNI原則**: 2ビュー対応、将来5ビューまでスケール可能
- **単一ファイル**: Router.js 1つで完結、過剰分割を回避
- **既存コード保護**: 現在のController/Viewは無変更
- **段階的実装**: Week 1（基本機能）→ Week 2（UI強化・データ受け渡し）

**実装ステップ**:
1. **Week 1前半**: Router.js基本実装、Hash-based ルーティング
2. **Week 1後半**: ナビゲーションヘッダーUI、タブ式切り替え  
3. **Week 2前半**: ブラウザ履歴連携、データ受け渡し機能
4. **Week 2後半**: モバイル対応、レスポンシブデザイン

#### 1.2 ver1 Services統合 - データ保存基盤強化 (Week 1-2)
**目標**: 参照フォルダのservices機能を現在のアーキテクチャに統合

**統合対象サービス**:
```javascript
// 参照フォルダから移行・統合予定
src/services/                 // 新規ディレクトリ
├── DataManager.js           // LocalStorage管理（強化版）
├── PortfolioAggregator.js   // CSV集約・ポートフォリオ計算
├── RakutenCsvParser.js      // 楽天証券CSV解析
└── SectorManager.js         // セクター分析・分類

// 現在のアーキテクチャとの統合
src/business/models/
├── AssetEntity.js           // ← SectorManager連携
├── AssetCalculator.js       // ← PortfolioAggregator連携
└── ...

src/data/
├── repositories/
│   └── AssetRepository.js   // ← DataManager連携
└── adapters/
    ├── LocalStorageAdapter.js    // 既存
    └── CsvImportAdapter.js       // 新規：CSV取り込み機能
```

#### 1.3 CSV取り込み機能実装 (Week 2-3)
**目標**: 楽天証券取引履歴からの一括データ取り込み

**実装機能**:
- **CSV アップロード UI**: ドラッグ&ドロップ対応
- **データ検証・変換**: RakutenCsvParserとの連携
- **重複データ処理**: 既存データとの照合・統合
- **プレビュー機能**: 取り込み前のデータ確認
- **エラーハンドリング**: 不正データの検出・修正提案

### Phase 2: 高度な分析機能・ポートフォリオ管理強化 【優先度: 高】

#### 2.1 セクター分析・ポートフォリオ最適化機能 (Week 3-4)
**目標**: SectorManagerとPortfolioAggregatorを活用した高度な分析

**統合されるver1機能**:
- **セクター分析ダッシュボード**:
  - 東証33業種分類ベースのセクター配分表示
  - セクター別パフォーマンス比較
  - 業種・地域分散度の可視化
- **ポートフォリオ集約機能**:
  - 楽天証券CSV履歴からの自動集約
  - 銘柄別損益・保有状況の詳細表示
  - 取引履歴ベースの実績計算

#### 2.2 データ可視化強化・マルチビュー対応 (Week 4-5)
**目標**: ナビゲーション機能を活用した複数画面での情報表示

**実装項目**:
```javascript
// ビュー構成の拡張
src/ui/views/
├── DashboardView.js            // メインダッシュボード
├── AssetFormView.js            // 資産追加フォーム
├── PortfolioAnalysisView.js    // 新規：ポートフォリオ分析画面
├── SectorAnalysisView.js       // 新規：セクター分析画面
└── ImportDataView.js           // 新規：データ取り込み画面

// チャート機能の強化
const enhancedCharts = [
  'sectorAllocationPieChart',       // セクター配分円グラフ
  'performanceTimelineChart',       // 期間別パフォーマンス
  'portfolioHeatMap',              // ポートフォリオヒートマップ
  'assetCorrelationMatrix',        // 資産相関マトリックス
  'riskReturnScatterPlot'          // リスク・リターン散布図
];
```

**ナビゲーション連携機能**:
- ビュー間でのフィルター状態の保持
- 詳細分析画面からの直接編集
- ダッシュボードへの分析結果反映

#### 2.3 データ統合・レポート機能 (Week 5-6)
**目標**: CSV取り込みとマニュアル入力の統合管理

**機能一覧**:
- **統合データ管理**:
  - CSV取り込みデータと手動入力の一元管理
  - データソースの識別・トレーサビリティ
  - 不整合データの検出・修正機能
- **レポート生成**:
  - 統合ポートフォリオレポート（PDF）
  - セクター分析レポート
  - 取引履歴ベースの税務レポート
- **データエクスポート**:
  - 統合データのCSVエクスポート
  - 税務申告用データの整形
  - バックアップ・復元機能

### Phase 3: 品質強化・テスト実装 【優先度: 中】

#### 3.1 統合システムのテスト実装 (Week 6-7)
**目標**: ver1 services統合後の品質担保

**テスト対象とテスト項目**:
```javascript
// 統合されたサービスのテスト
describe('IntegratedServices', () => {
  // DataManager テスト
  test('LocalStorage操作の正確性')
  test('大量データの処理パフォーマンス')
  
  // RakutenCsvParser テスト
  test('日本株・US株CSVの正確な解析')
  test('エンコーディング対応（Shift-JIS）')
  test('不正データの検出・エラーハンドリング')
  
  // PortfolioAggregator テスト
  test('銘柄別集約の正確性')
  test('損益計算の精度')
  test('重複取引の適切な処理')
  
  // SectorManager テスト
  test('セクター分類の正確性')
  test('東証33業種との整合性')
  test('銘柄コードとセクターのマッピング')
});

// ナビゲーション・ルーティングテスト
describe('NavigationSystem', () => {
  test('ビュー間遷移の動作')
  test('ブラウザ履歴との連携')
  test('状態保持機能')
  test('レスポンシブ対応')
});
```

#### 3.2 パフォーマンス・統合テスト (Week 7-8)
**目標**: 複合機能での動作保証とパフォーマンス最適化

**テスト項目**:
- **大量データテスト**: 1000件のCSV取り込み・集約処理
- **メモリ効率**: 長時間使用時のメモリリーク検証
- **レンダリング速度**: 複数ビューでのチャート表示速度
- **データ整合性**: CSV取り込みと手動入力の統合処理

#### 3.3 ユーザビリティテスト・UI/UX改善 (Week 8-9)
**目標**: 実用的な投資管理ツールとしての完成度向上

**実装項目**:
- **エラーハンドリング強化**: 
  - CSV取り込みエラーの詳細表示
  - 楽天証券フォーマット変更への対応
  - データ修復・復旧機能
- **ユーザーガイダンス**:
  - 初回利用時のチュートリアル
  - CSV取り込み手順のガイド
  - 機能説明のヘルプシステム
- **アクセシビリティ**:
  - キーボードナビゲーション
  - スクリーンリーダー対応
  - カラーユニバーサルデザイン

### Phase 4: 将来機能・実験的機能 【優先度: 低】

#### 4.1 AI・機械学習連携 (Week 10+)
**目標**: インテリジェントな投資分析

**実装検討項目**:
- ポートフォリオ最適化提案
- リスク予測モデル
- 市場トレンド分析
- 異常検知アラート

#### 4.2 外部データ連携 (Week 10+)
**目標**: リアルタイム市場データの活用

**連携候補**:
- 株価API連携
- 為替レートAPI連携
- 経済指標データ連携
- ニュースデータ連携

## 🛠 技術スタック発展計画

### 現在の技術構成
```
Frontend: Vanilla JS + HTML5 + CSS3
Charts: Chart.js
Storage: LocalStorage
Architecture: Layered Architecture
```

### 将来の技術構成（目標）
```
Frontend: TypeScript + Modern JS
Build: Vite + ESLint + Prettier  
Testing: Jest/Vitest + Testing Library
Charts: Chart.js + D3.js
State: Custom State Management
Storage: LocalStorage + IndexedDB
Architecture: Layered + Observer Pattern
```

## 📋 開発ガイドライン

### 1. コード品質基準
- **JSDoc**: すべてのpublic メソッドに詳細な説明
- **エラーハンドリング**: 適切な例外処理とユーザーフィードバック
- **ロギング**: 開発・デバッグ用の詳細ログ
- **命名規則**: 日本語コメント + 英語コード

### 2. テスト基準
- **カバレッジ**: 最低80%以上
- **重要機能**: 100%カバレッジ必須
- **エッジケース**: 境界値・異常系テスト
- **統合テスト**: コンポーネント間連携テスト

### 3. パフォーマンス基準
- **初期読み込み**: 2秒以内
- **操作レスポンス**: 0.5秒以内
- **大量データ**: 1000件まで快適動作
- **メモリ使用量**: 50MB以内

## 🎯 成功指標（KPI）

### 技術指標
- **コードカバレッジ**: 80%以上
- **バグ発生率**: 月間5件以下
- **パフォーマンス**: Core Web Vitals 良好
- **保守性**: 機能追加1週間以内

### ユーザー体験指標
- **読み込み速度**: 2秒以内
- **操作エラー**: 週間3件以下
- **機能完遂率**: 95%以上
- **ユーザー満足度**: 主観評価4.5/5以上

## 🚨 リスク管理

### 技術的リスク
1. **TypeScript移行**: 学習コスト・移行時間
   - 対策: 段階的移行・十分な学習期間確保
2. **パフォーマンス劣化**: 機能追加による速度低下
   - 対策: 継続的パフォーマンステスト・プロファイリング
3. **コード複雑化**: 機能追加による保守性低下
   - 対策: リファクタリング・アーキテクチャレビュー

### 開発リスク
1. **スコープクリープ**: 機能要求の無制限拡大
   - 対策: 明確な優先度設定・段階的リリース
2. **技術的負債**: 急速開発による品質低下
   - 対策: 定期的なコードレビュー・リファクタリング期間

## 📅 開発スケジュール概要

### 短期目標 (1-2ヶ月) - ver1統合・ナビゲーション実装
- ✅ Asset.js分割: 完了
- 🎯 **ビュー間ナビゲーション実装**: DashboardView ⇔ AssetFormView の遷移
- 🎯 **ver1 Services統合**: DataManager, PortfolioAggregator, RakutenCsvParser, SectorManager
- 🎯 **CSV取り込み機能**: 楽天証券取引履歴の一括インポート
- 🎯 **統合テスト**: services連携とナビゲーション動作確認

### 中期目標 (3-4ヶ月) - 高度な分析・マルチビュー対応  
- 🎯 **セクター分析機能**: 東証33業種ベースの詳細分析
- 🎯 **ポートフォリオ最適化**: CSV集約データとマニュアル入力の統合
- 🎯 **マルチビュー拡張**: PortfolioAnalysisView, SectorAnalysisView, ImportDataView
- 🎯 **データ可視化強化**: セクター配分、パフォーマンス推移、相関分析
- 🎯 **統合レポート機能**: 税務申告対応、バックアップ・復元

### 長期目標 (6ヶ月+) - 完全統合・高度機能
- 🎯 **完全統合システム**: ver1とver2の機能完全統合
- 🎯 **高度UI/UX**: チュートリアル、ヘルプシステム、アクセシビリティ
- 🎯 **パフォーマンス最適化**: 大量データ処理、メモリ効率化
- 🎯 **外部連携準備**: 証券会社API、税務システム連携検討

---

## 🎉 結論

Asset.js分割により、投資ダッシュボードv2のBusinessLayerが完成しました。今後は**ver1機能統合**と**ナビゲーション実装**を最優先とし、**Services統合**→**マルチビュー対応**→**高度分析機能**の順で段階的に発展させていく方針です。

**重点戦略**:
1. **短期**: ver1の実績あるservices（CSV解析・セクター分析等）をv2アーキテクチャに統合
2. **中期**: ビュー間ナビゲーションを活用した使いやすいマルチ画面システム
3. **長期**: 楽天証券データ活用による実用的な投資管理ツール完成

各フェーズで実用性と保守性のバランスを保ちながら、ver1の優れた機能とv2の堅牢なアーキテクチャを融合した、投資家にとって真に価値のあるツールへと進化させていきます。

**次回実装推奨**: **Phase 1.1 ビュー間ナビゲーション実装**から開始し、DashboardViewとAssetFormView間のスムーズな遷移を実現することをお勧めします。