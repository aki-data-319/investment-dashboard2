# 保有銘柄管理ボタン → データベースページ遷移機能 要件定義書

## 📋 基本情報

**機能名:** 保有銘柄管理ボタン → データベースページ遷移機能  
**作成日:** 2025年9月23日  
**優先度:** 中  
**完了予定:** 2025年9月23日  

## 🎯 機能概要

ダッシュボードページの「保有銘柄管理」ボタンをクリックした際に、データベースページ（取引履歴・銘柄情報の詳細管理画面）に遷移する機能を実装する。

## 📋 要件詳細

### 機能要件

#### FR-001: ボタンクリック時のページ遷移
- **説明:** ダッシュボードページの「保有銘柄管理」ボタンクリック時にデータベースページに遷移する
- **入力:** ユーザーのボタンクリック操作
- **出力:** データベースページへの画面遷移
- **条件:** ボタンクリック時に即座に遷移実行

#### FR-002: 既存ナビゲーション統合
- **説明:** 既存のRouter.jsによるナビゲーション機能と統合する
- **詳細:** `router.navigate('database')` を使用してSPA形式で遷移
- **制約:** ページリフレッシュは行わない

#### FR-003: 一貫性のあるUX
- **説明:** 「銘柄追加」ボタンと同様のイベント処理パターンを適用
- **詳細:** DashboardControllerにイベントハンドラーを追加
- **UI要件:** ボタン押下時の視覚的フィードバック

### 非機能要件

#### NFR-001: パフォーマンス
- **応答時間:** ボタンクリックから画面遷移まで500ms以内
- **メモリ使用量:** 既存のRouter機能を活用し、追加メモリ使用量は最小限

#### NFR-002: 互換性
- **既存機能:** 既存のダッシュボード機能・ナビゲーション機能に影響を与えない
- **他ページ:** データベースページの既存機能は維持

#### NFR-003: 保守性
- **コード一貫性:** 既存の「銘柄追加」ボタンと同様の実装パターンを採用
- **拡張性:** 将来的な他ボタンの追加に対応可能な構造

## 🔍 現状分析

### 現在の「保有銘柄管理」ボタン

**ファイル:** `/src/ui/views/DashboardView.js` (109-112行)
```html
<button class="btn-primary h-16 flex flex-col gap-1 rounded-lg border">
    <i data-lucide="database" class="h-5 w-5"></i>
    <span class="text-xs">保有銘柄管理</span>
</button>
```

**現状:**
- ✅ UIは既に存在
- ❌ idが設定されていない
- ❌ クリックイベントが設定されていない
- ❌ DashboardControllerにイベントハンドラーが存在しない

### 既存の「銘柄追加」ボタン（参考実装）

**ファイル:** `/src/ui/views/DashboardView.js` (113-116行)
```html
<button class="btn-secondary h-16 flex flex-col gap-1 rounded-lg border" id="addAssetBtn">
    <i data-lucide="plus" class="h-5 w-5"></i>
    <span class="text-xs">銘柄追加</span>
</button>
```

**既存実装:**
- ✅ `id="addAssetBtn"` が設定済み
- ✅ DashboardController.bindEvents()でイベント設定済み
- ✅ DashboardController.handleAddAsset()でハンドラー実装済み

### Routerの既存設定

**ファイル:** `/src/ui/Router.js` (54-58行)
```javascript
this.registerRoute('database', DatabaseController, {
    title: 'データベース',
    icon: 'database',
    description: '取引履歴・銘柄情報の詳細管理'
});
```

**Router機能:**
- ✅ 'database' ルートが登録済み
- ✅ `router.navigate('database')` で遷移可能
- ✅ データベースページ表示機能が実装済み

## 🚦 ユーザーフロー

### 改善前（現状）
```
1. ダッシュボードページを表示
2. 「保有銘柄管理」ボタンをクリック
3. 何も起こらない（機能未実装）
```

### 改善後（実装後）
```
1. ダッシュボードページを表示
2. 「保有銘柄管理」ボタンをクリック
3. データベースページに遷移
4. 取引履歴・銘柄情報管理画面が表示される
```

## 📁 関連ファイル・メソッド分析

### 主要ファイル

| ファイル | 役割 | 変更必要性 |
|---------|------|----------|
| `/src/ui/views/DashboardView.js` | ダッシュボードUIテンプレート | ✅ 必要（id追加） |
| `/src/ui/controllers/DashboardController.js` | ダッシュボード制御ロジック | ✅ 必要（イベント処理追加） |
| `/src/ui/Router.js` | ページ遷移制御 | ❌ 不要（既に実装済み） |

### 関連メソッド

#### 参考にする既存メソッド
1. **DashboardController.bindEvents()** (180-188行)
   - 「銘柄追加」ボタンのイベント設定
   - 同様のパターンで「保有銘柄管理」ボタンも設定

2. **DashboardController.handleAddAsset()** (198-209行)
   - 「銘柄追加」ボタンのクリック処理
   - 同様のパターンで「保有銘柄管理」ボタンの処理を実装

3. **Router.navigate()** (127-168行)
   - ページ遷移の実行
   - `router.navigate('database')` でデータベースページに遷移

#### 新規実装が必要なメソッド
1. **DashboardController.handleManageHoldings()** (新規)
   - 「保有銘柄管理」ボタンのクリック処理
   - Router.navigate('database') を呼び出し

## 🔧 技術仕様

### イベント処理フロー
```
1. ユーザーが「保有銘柄管理」ボタンをクリック
2. DOMイベント発生
3. DashboardController.handleManageHoldings() が実行
4. Router.navigate('database') を呼び出し
5. Routerがdatabaseページに遷移
6. DatabaseControllerが初期化・表示処理を実行
```

### DOM要素識別
- **ボタンID:** `managementBtn` (新規設定)
- **イベントタイプ:** click
- **ハンドラー:** `this.handleManageHoldings.bind(this)`

### エラーハンドリング
- Router未初期化時の対応
- データベースページ読み込み失敗時の対応
- 既存の「銘柄追加」ボタンと同様のtry-catch構造

## ✅ 受け入れ条件

### 機能面
- [ ] 「保有銘柄管理」ボタンクリック時にデータベースページに遷移する
- [ ] 遷移後にデータベースページが正常に表示される
- [ ] ナビゲーションヘッダーのアクティブタブが「データベース」に変更される

### 技術面
- [ ] 既存の「銘柄追加」ボタン機能に影響しない
- [ ] Router.jsの既存機能を活用している
- [ ] コードが既存パターンと一貫性を保っている

### UX面
- [ ] ボタンクリックから遷移まで500ms以内
- [ ] ページリフレッシュが発生しない（SPA遷移）
- [ ] エラー発生時に適切なメッセージが表示される

## 🚧 制約・前提条件

### 前提条件
- Router.jsが正常に初期化されている
- DatabaseControllerが正常に動作している
- ダッシュボードページが正常に表示されている

### 制約事項
- 既存のUI配置・スタイルは変更しない
- 既存の機能に影響を与えない
- SPA形式での遷移のみサポート（新しいタブでの開くは対象外）

### 除外事項
- データベースページの機能改修は含まない
- ボタンのデザイン変更は含まない
- パフォーマンス最適化は本機能では含まない

## 📊 影響範囲

### 直接影響
- **DashboardView.js:** ボタンへのid属性追加
- **DashboardController.js:** イベント処理とハンドラーメソッド追加

### 間接影響
- **Router.js:** 既存機能の活用（変更なし）
- **DatabaseController.js:** 遷移先として利用（変更なし）

### 影響なし
- 他のページ（CSV取り込み、資産追加フォーム）
- データベース機能の既存処理
- 既存のナビゲーション機能

## 🧪 テストシナリオ

### 正常系テスト
1. **基本遷移テスト**
   - ダッシュボードページで「保有銘柄管理」ボタンをクリック
   - データベースページに遷移することを確認
   - ナビゲーションタブが「データベース」になることを確認

2. **既存機能併用テスト**
   - 「銘柄追加」ボタンが正常に動作することを確認
   - 「保有銘柄管理」ボタンと「銘柄追加」ボタンを交互にクリック
   - 両方の機能が正常に動作することを確認

### 異常系テスト
1. **Router未初期化テスト**
   - Router未初期化状態でボタンをクリック
   - 適切なエラーメッセージが表示されることを確認

2. **連続クリックテスト**
   - 「保有銘柄管理」ボタンを連続でクリック
   - 二重遷移が発生しないことを確認

## 🎯 成功指標

### 定量指標
- ボタンクリックから遷移完了まで: 500ms以内
- エラー発生率: 0%
- 既存機能への影響: 0件

### 定性指標
- ユーザーが迷わずデータベースページにアクセスできる
- 既存の「銘柄追加」ボタンと同等のUXを提供
- 実装コードが保守しやすい構造になっている

---

**作成者:** Claude  
**レビュー:** 未実施  
**承認:** 未実施