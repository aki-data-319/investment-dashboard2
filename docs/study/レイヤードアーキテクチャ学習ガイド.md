# ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ å®Œå…¨å­¦ç¿’ã‚¬ã‚¤ãƒ‰

**å¯¾è±¡**: æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v2 é–‹ç™ºè€…  
**ãƒ¬ãƒ™ãƒ«**: åˆå¿ƒè€…ã€œä¸­ç´šè€…  
**å­¦ç¿’æ™‚é–“**: ç´„60åˆ†  

---

## ğŸ“– ç›®æ¬¡

1. [ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯](#1-ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯)
2. [ãªãœãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã‚‹ã®ã‹](#2-ãªãœãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã‚‹ã®ã‹)
3. [æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®å®Ÿä¾‹](#3-æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®å®Ÿä¾‹)
4. [å„å±¤ã®è©³ç´°è§£èª¬](#4-å„å±¤ã®è©³ç´°è§£èª¬)
5. [ä¾å­˜é–¢ä¿‚ã®ãƒ«ãƒ¼ãƒ«](#5-ä¾å­˜é–¢ä¿‚ã®ãƒ«ãƒ¼ãƒ«)
6. [å®Ÿè·µæ¼”ç¿’](#6-å®Ÿè·µæ¼”ç¿’)
7. [ã‚ˆãã‚ã‚‹é–“é•ã„ã¨å¯¾ç­–](#7-ã‚ˆãã‚ã‚‹é–“é•ã„ã¨å¯¾ç­–)
8. [ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯](#8-ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯)

---

## 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯

### ğŸ—ï¸ åŸºæœ¬æ¦‚å¿µ

**ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è¤‡æ•°ã®ã€Œå±¤ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ã€ã«åˆ†å‰²ã™ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

```
ğŸ° ã‚±ãƒ¼ã‚­ã«ä¾‹ãˆã‚‹ã¨...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ’ ãƒˆãƒƒãƒ”ãƒ³ã‚°    â”‚ â† Presentation Layer (è¦‹ãŸç›®)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ§ ã‚¯ãƒªãƒ¼ãƒ      â”‚ â† Application Layer (å‘³ã®èª¿æ•´)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   ğŸ° ã‚¹ãƒãƒ³ã‚¸     â”‚ â† Business Layer (ä¸»è¦ãªå‘³)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ¥§ åœŸå°        â”‚ â† Data Layer (åŸºç¤)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ æ ¸å¿ƒåŸå‰‡

1. **å˜ä¸€è²¬å‹™**: å„å±¤ã¯1ã¤ã®æ˜ç¢ºãªè²¬å‹™ã‚’æŒã¤
2. **ä¸€æ–¹å‘ä¾å­˜**: ä¸Šä½å±¤ã¯ä¸‹ä½å±¤ã«ã®ã¿ä¾å­˜
3. **æŠ½è±¡åŒ–**: å„å±¤ã¯ä¸‹ä½å±¤ã®å®Ÿè£…è©³ç´°ã‚’çŸ¥ã‚‰ãªã„
4. **ç½®æ›å¯èƒ½**: åŒä¸€å±¤å†…ã§å®Ÿè£…ã‚’å…¥ã‚Œæ›¿ãˆå¯èƒ½

---

## 2. ãªãœãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã‚‹ã®ã‹

### ğŸ”§ æŠ€è¡“çš„ãƒ¡ãƒªãƒƒãƒˆ

#### **ä¿å®ˆæ€§ï¼ˆMaintainabilityï¼‰**
```javascript
// âŒ å±¤ãŒãªã„å ´åˆï¼šã™ã¹ã¦ãŒçµ¡ã¿åˆã†
function importCsv(file) {
    // UIå‡¦ç†ã€ãƒ‡ãƒ¼ã‚¿è§£æã€è¨ˆç®—ã€ä¿å­˜ãŒæ··åœ¨
    const reader = new FileReader();
    reader.readAsText(file, 'Shift_JIS'); // æŠ€è¡“çš„è©³ç´°
    const sector = determineSector(code);  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    localStorage.setItem(key, data);       // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    updateUI(result);                      // UIæ›´æ–°
}

// âœ… å±¤ãŒã‚ã‚‹å ´åˆï¼šè²¬å‹™ãŒåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹
function importCsv(file) {
    // ã“ã®é–¢æ•°ã¯ã€Œèª¿æ•´ã€ã®ã¿æ‹…å½“
    const parsed = csvParser.parse(file);      // Infrastructure
    const withSector = sectorService.assign(parsed); // Business
    const saved = repository.save(withSector);       // Data
    view.display(saved);                             // Presentation
}
```

#### **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ï¼ˆTestabilityï¼‰**
```javascript
// å„å±¤ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
describe('SectorService', () => {
    it('should assign correct sector for Toyota', () => {
        const sectorService = new SectorService();
        const stock = { code: '7203', name: 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š' };
        
        const result = sectorService.assignSector(stock);
        
        expect(result.sector).toBe('è‡ªå‹•è»Š');
    });
});
```

#### **å†åˆ©ç”¨æ€§ï¼ˆReusabilityï¼‰**
```javascript
// SectorServiceã¯è¤‡æ•°ã®å ´æ‰€ã§ä½¿ãˆã‚‹
class CsvImportService {
    constructor() {
        this.sectorService = new SectorService(); // å†åˆ©ç”¨
    }
}

class PortfolioAnalyzer {
    constructor() {
        this.sectorService = new SectorService(); // åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†åˆ©ç”¨
    }
}
```

### ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹çš„ãƒ¡ãƒªãƒƒãƒˆ

1. **ãƒãƒ¼ãƒ åˆ†æ‹…**: UIæ‹…å½“è€…ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ‹…å½“è€…ã§åˆ†æ¥­
2. **æŠ€è¡“å¤‰æ›´å¯¾å¿œ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´æ™‚ã€ä»–ã®å±¤ã¸ã®å½±éŸ¿æœ€å°
3. **æ®µéšçš„é–‹ç™º**: ä¸‹ä½å±¤ã‹ã‚‰ä¸Šä½å±¤ã¸é †æ¬¡æ§‹ç¯‰

---

## 3. æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®å®Ÿä¾‹

### ğŸ¢ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
ğŸ“± æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v2 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¼ï¸  Presentation Layer (UIå±¤)                  â”‚
â”‚  src/ui/                                       â”‚  
â”‚  â”œâ”€â”€ views/       ğŸ“º HTMLæç”»ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ        â”‚
â”‚  â”œâ”€â”€ controllers/ ğŸ® ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†   â”‚  
â”‚  â””â”€â”€ components/  ğŸ§© å†åˆ©ç”¨å¯èƒ½ãªUIéƒ¨å“          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§   Application Layer (Serviceså±¤)             â”‚
â”‚  src/services/                                 â”‚
â”‚  â”œâ”€â”€ CsvImportService.js    ğŸ“Š CSVå–ã‚Šè¾¼ã¿æ¥­å‹™  â”‚
â”‚  â”œâ”€â”€ PortfolioService.js    ğŸ’¼ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†â”‚
â”‚  â””â”€â”€ ReportService.js       ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  ğŸ’¼  Business Layer (ãƒ“ã‚¸ãƒã‚¹å±¤)                 â”‚
â”‚  src/business/                                 â”‚
â”‚  â”œâ”€â”€ services/   ğŸ§® ã‚»ã‚¯ã‚¿ãƒ¼åˆ†æãƒ»ãƒªã‚¹ã‚¯è¨ˆç®—     â”‚
â”‚  â”œâ”€â”€ models/     ğŸ“¦ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ”‚
â”‚  â””â”€â”€ analysis/   ğŸ“ˆ æŠ•è³‡åˆ†æã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸª  Data Layer (ãƒ‡ãƒ¼ã‚¿å±¤)                      â”‚  
â”‚  src/data/                                     â”‚
â”‚  â”œâ”€â”€ managers/     ğŸ’¾ LocalStorageç®¡ç†         â”‚
â”‚  â”œâ”€â”€ repositories/ ğŸ—„ï¸ CRUDæ“ä½œæŠ½è±¡åŒ–           â”‚
â”‚  â””â”€â”€ migrations/   ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”Œ  Infrastructure Layer (åŸºç›¤å±¤)              â”‚
â”‚  src/infrastructure/                           â”‚
â”‚  â”œâ”€â”€ parsers/    ğŸ“„ CSVãƒ»å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿è§£æ        â”‚
â”‚  â”œâ”€â”€ apis/       ğŸŒ å¤–éƒ¨APIé€£æº               â”‚
â”‚  â””â”€â”€ utils/      ğŸ› ï¸ æŠ€è¡“çš„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¾‹ï¼šCSVå–ã‚Šè¾¼ã¿

```
ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    â¬‡ï¸
ğŸ–¼ï¸ UI Layer: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡
    â¬‡ï¸
ğŸ§  Application Layer: CSVå–ã‚Šè¾¼ã¿å‡¦ç†ã‚’é–‹å§‹
    â¬‡ï¸
ğŸ”Œ Infrastructure Layer: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ
    â¬‡ï¸  
ğŸ’¼ Business Layer: ã‚»ã‚¯ã‚¿ãƒ¼åˆ†é¡ãƒ»ãƒªã‚¹ã‚¯è¨ˆç®—
    â¬‡ï¸
ğŸª Data Layer: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    â¬‡ï¸
ğŸ§  Application Layer: çµæœã‚’çµ±åˆ
    â¬‡ï¸
ğŸ–¼ï¸ UI Layer: çµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
    â¬‡ï¸
ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: å–ã‚Šè¾¼ã¿å®Œäº†ã‚’ç¢ºèª
```

---

## 4. å„å±¤ã®è©³ç´°è§£èª¬

### ğŸ–¼ï¸ Presentation Layerï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰

**è²¬å‹™**: ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã€

#### ä¸»ãªæ©Ÿèƒ½
- HTMLç”Ÿæˆãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å—ä»˜
- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆã‚¯ãƒªãƒƒã‚¯ã€å…¥åŠ›ç­‰ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

#### å®Ÿä¾‹ï¼šDatabaseController.js
```javascript
class DatabaseController {
    constructor(dataStoreManager) {
        this.dataStoreManager = dataStoreManager;
        this.view = new DatabaseView();
        // ğŸ¯ è²¬å‹™ï¼šç”»é¢åˆ¶å¾¡ã®ã¿
    }

    showDatabase() {
        // âœ… æ­£ã—ã„è²¬å‹™ï¼šHTMLæç”»
        const mainContent = document.getElementById('mainContent');
        mainContent.innerHTML = this.view.render();
        
        // âœ… æ­£ã—ã„è²¬å‹™ï¼šåˆæœŸåŒ–
        this.initialize();
        this.loadTransactionsTab();
    }
    
    // âŒ é–“é•ã£ãŸè²¬å‹™ä¾‹ï¼šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã„ã¦ã¯ã„ã‘ãªã„
    // calculatePortfolioRisk() { /* Business Layerã®è²¬å‹™ */ }
    // parseCsvFile() { /* Infrastructure Layerã®è²¬å‹™ */ }
}
```

#### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- **ä½•ã‚’è¡¨ç¤ºã™ã‚‹ã‹**ã§ã¯ãªã**ã©ã†è¡¨ç¤ºã™ã‚‹ã‹**ã«é›†ä¸­
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ä¸‹ä½å±¤ã«å§”è­²
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚’é‡è¦–

### ğŸ§  Application Layerï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰

**è²¬å‹™**: ã€Œæ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®ç·¨æˆã€

#### ä¸»ãªæ©Ÿèƒ½
- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
- è¤‡æ•°ã®Businessã‚µãƒ¼ãƒ“ã‚¹ã®èª¿æ•´
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®ç®¡ç†
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ»ãƒ­ã‚°å‡ºåŠ›

#### å®Ÿä¾‹ï¼šCsvImportService.js
```javascript
class CsvImportService {
    constructor({ assetRepository, sectorService }) {
        this.assetRepository = assetRepository;
        this.parser = new RakutenCsvParser();
        this.sectorService = sectorService;
        // ğŸ¯ è²¬å‹™ï¼šè¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®èª¿æ•´
    }

    async parseAndPreview(file, csvType, progressCallback) {
        try {
            // 1ï¸âƒ£ Infrastructure Layeræ´»ç”¨
            const parseResult = await this.parser.parseCsvFile(file, csvType, progressCallback);
            
            if (!parseResult.success) {
                throw new Error(`CSVè§£æã‚¨ãƒ©ãƒ¼: ${parseResult.error}`);
            }
            
            // 2ï¸âƒ£ Business Layeræ´»ç”¨ï¼ˆå°†æ¥ï¼‰
            // const enrichedData = this.sectorService.enrichWithSectors(parseResult.data);
            
            // 3ï¸âƒ£ çµæœã®çµ±åˆã¨è¿”å´
            return {
                transactions: parseResult.data || [],
                warnings: parseResult.debugInfo?.encodingSuccess ? [] : ['encoding-issues'],
                // ...
            };
            
        } catch (error) {
            // ğŸ¯ è²¬å‹™ï¼šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            console.error('âŒ CSVè§£æã‚¨ãƒ©ãƒ¼:', error);
            return { transactions: [], warnings: ['parse-error'], error: error.message };
        }
    }
}
```

#### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼**ã¨ã—ã¦æ©Ÿèƒ½
- è¤‡é›‘ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼ã‚’ç®¡ç†
- ä¸‹ä½å±¤ã®çµæœã‚’çµ±åˆã—ã¦ä¸Šä½å±¤ã«æä¾›

### ğŸ’¼ Business Layerï¼ˆãƒ“ã‚¸ãƒã‚¹å±¤ï¼‰

**è²¬å‹™**: ã€Œãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãƒ»è¨ˆç®—ã€

#### ä¸»ãªæ©Ÿèƒ½
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ¥­ç•Œç‰¹æœ‰ã®è¨ˆç®—ï¼‰
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆåˆ¶ç´„ãƒ»æ¤œè¨¼ï¼‰
- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆé‡‘èå·¥å­¦ãƒ»çµ±è¨ˆï¼‰
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç®¡ç†

#### å®Ÿä¾‹ï¼šSectorService.js
```javascript
class SectorService {
    constructor() {
        // ğŸ¯ è²¬å‹™ï¼šæŠ•è³‡æ¥­ç•Œã®å°‚é–€çŸ¥è­˜
        this.sectorMaster = {
            JP: {
                '7203': { sector: 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š', subSector: 'è‡ªå‹•è»Š' },
                '6758': { sector: 'ã‚½ãƒ‹ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—', subSector: 'é›»æ°—æ©Ÿå™¨' }
            },
            US: {
                'AAPL': { sector: 'Technology', subSector: 'Hardware' },
                'MSFT': { sector: 'Technology', subSector: 'Software' }
            }
        };
    }

    assignSectorToStock(stock) {
        // ğŸ¯ è²¬å‹™ï¼šãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«å®Ÿè£…
        const region = stock.region || 'JP';
        const identifier = stock.ticker || stock.code || '';
        
        // ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’å„ªå…ˆï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰
        const customMapping = this.customSectorMappings[`${region}_${identifier}`];
        if (customMapping) {
            return { ...stock, sector: customMapping.sector, sectorSource: 'custom' };
        }

        // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ï¼ˆæ¥­ç•Œæ¨™æº–ï¼‰
        const masterData = this.sectorMaster[region];
        if (masterData && masterData[identifier]) {
            return { ...stock, sector: masterData[identifier].sector, sectorSource: 'master' };
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰
        return { ...stock, sector: 'ãã®ä»–', sectorSource: 'default' };
    }

    calculateConcentrationRisk(sectorAllocation) {
        // ğŸ¯ è²¬å‹™ï¼šé‡‘èå·¥å­¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆHHIæŒ‡æ•°ï¼‰
        const hhi = sectorAllocation.reduce((sum, sector) => {
            return sum + Math.pow(sector.percentage, 2);
        }, 0);

        // ğŸ¯ è²¬å‹™ï¼šãƒªã‚¹ã‚¯åˆ¤å®šï¼ˆæŠ•è³‡æ¥­ç•Œã®çŸ¥è­˜ï¼‰
        let riskLevel = 'ä½';
        if (hhi > 2500) riskLevel = 'é«˜';
        else if (hhi > 1500) riskLevel = 'ä¸­';

        return {
            hhi,
            riskLevel,
            interpretation: hhi > 2500 ? 'ã‚»ã‚¯ã‚¿ãƒ¼é›†ä¸­åº¦ãŒé«˜ã„ã§ã™' : 
                           hhi > 1500 ? 'é©åº¦ã«åˆ†æ•£ã•ã‚Œã¦ã„ã¾ã™' : 
                           'è‰¯å¥½ãªåˆ†æ•£æŠ•è³‡ã§ã™'
        };
    }
}
```

#### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- **ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜**ã‚’ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¾
- æŠ€è¡“çš„è©³ç´°ã¯çŸ¥ã‚‰ãªã„ï¼ˆDBã‚„UIã¯ç„¡é–¢å¿ƒï¼‰
- **ä¸å¤‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**ã‚’å®Ÿè£…

### ğŸª Data Layerï¼ˆãƒ‡ãƒ¼ã‚¿å±¤ï¼‰

**è²¬å‹™**: ã€Œãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ãƒ»å–å¾—ã€

#### ä¸»ãªæ©Ÿèƒ½
- CRUDæ“ä½œï¼ˆCreate, Read, Update, Deleteï¼‰
- ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ½è±¡åŒ–
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### å®Ÿä¾‹ï¼šDataStoreManager.js
```javascript
class DataStoreManager {
    constructor() {
        // ğŸ¯ è²¬å‹™ï¼šãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€ã®ç®¡ç†
        this.STORAGE_KEYS = {
            mutualFunds: 'investment_mutual_funds',
            stocks: 'investment_stocks',
            cryptoAssets: 'investment_crypto_assets',
        };
    }

    save(key, data) {
        try {
            // ğŸ¯ è²¬å‹™ï¼šãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®æŠ€è¡“çš„è©³ç´°
            const serialized = JSON.stringify(data);
            localStorage.setItem(key, serialized);
            return true;
        } catch (error) {
            // ğŸ¯ è²¬å‹™ï¼šã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼å‡¦ç†
            if (error.name === 'QuotaExceededError') {
                console.error('ä¿å­˜å®¹é‡ä¸è¶³');
            }
            return false;
        }
    }

    load(key) {
        try {
            // ğŸ¯ è²¬å‹™ï¼šãƒ‡ãƒ¼ã‚¿å¾©å…ƒã®æŠ€è¡“çš„è©³ç´°
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : null;
        } catch (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            return null;
        }
    }

    // ğŸ¯ è²¬å‹™ï¼šãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    _migrateFundData(fund) {
        // å¤ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‹ã‚‰æ–°ã—ã„å½¢å¼ã¸ã®å¤‰æ›
        if (!fund.version || fund.version < 2) {
            return {
                ...fund,
                version: 2,
                updatedAt: new Date().toISOString()
            };
        }
        return fund;
    }
}
```

#### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æŠ€è¡“çš„è©³ç´°**ã‚’éš è”½
- ä¸Šä½å±¤ã¯ã€Œä¿å­˜ã€ã€Œå–å¾—ã€ã¨ã„ã†æŠ½è±¡çš„ãªæ“ä½œã®ã¿çŸ¥ã‚‹
- ãƒ‡ãƒ¼ã‚¿å½¢å¼å¤‰æ›´æ™‚ã®å½±éŸ¿ã‚’æœ€å°åŒ–

### ğŸ”Œ Infrastructure Layerï¼ˆåŸºç›¤å±¤ï¼‰

**è²¬å‹™**: ã€Œå¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºãƒ»æŠ€è¡“çš„æ©Ÿèƒ½ã€

#### ä¸»ãªæ©Ÿèƒ½
- å¤–éƒ¨APIå‘¼ã³å‡ºã—
- ãƒ•ã‚¡ã‚¤ãƒ«è§£æãƒ»å¤‰æ›
- æŠ€è¡“çš„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé€£æº

#### å®Ÿä¾‹ï¼šRakutenCsvParser.js
```javascript
class RakutenCsvParser {
    async readCsvFileWithProperEncoding(file) {
        const encodings = ['Shift_JIS', 'UTF-8', 'ISO-8859-1'];
        
        for (const encoding of encodings) {
            try {
                // ğŸ¯ è²¬å‹™ï¼šæŠ€è¡“çš„è¤‡é›‘ã•ã®éš è”½
                const text = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (event) => resolve(event.target.result);
                    reader.onerror = () => reject(new Error(`${encoding}ã§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—`));
                    reader.readAsText(file, encoding);
                });
                
                // ğŸ¯ è²¬å‹™ï¼šã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¤œè¨¼
                if (this.containsValidJapanese(text)) {
                    return text;
                }
                
            } catch (error) {
                continue;
            }
        }
        
        throw new Error('ã™ã¹ã¦ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }

    convertSingleRow(row, csvType) {
        // ğŸ¯ è²¬å‹™ï¼šæ¥½å¤©è¨¼åˆ¸å›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼å¤‰æ›
        switch (csvType) {
            case 'JP':
                return {
                    date: this.parseDate(row['ç´„å®šæ—¥']),
                    name: row['éŠ˜æŸ„å'] || '',
                    code: row['éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰'] || '',
                    quantity: this.parseQuantity(row['æ•°é‡ï¼»æ ªï¼½'] || '0'),
                    unitPrice: this.parseAmount(row['å˜ä¾¡ï¼»å††ï¼½'] || '0'),
                    // ...
                };
            // ...
        }
    }
}
```

#### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- **å¤–éƒ¨ã®è¤‡é›‘ã•**ã‚’ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨ã«æŒã¡è¾¼ã¾ãªã„
- æŠ€è¡“å¤‰æ›´ï¼ˆCSVå½¢å¼å¤‰æ›´ç­‰ï¼‰ã®å½±éŸ¿ã‚’å±€æ‰€åŒ–
- **ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³**ã§å¤–éƒ¨å½¢å¼ã‚’å†…éƒ¨å½¢å¼ã«å¤‰æ›

---

## 5. ä¾å­˜é–¢ä¿‚ã®ãƒ«ãƒ¼ãƒ«

### ğŸ“ åŸºæœ¬åŸå‰‡

```
ğŸš« ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ä¾å­˜é–¢ä¿‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Layer      â”‚ â¬…ï¸ âŒ Application Layer
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    âŒ Business Layer  
â”‚ Application     â”‚ â¬…ï¸ âŒ Data Layer
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    âŒ Infrastructure Layer
â”‚   Business      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Data        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Infrastructure  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æ­£ã—ã„ä¾å­˜é–¢ä¿‚  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Layer      â”‚ â¡ï¸ Application Layer ã®ã¿
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application     â”‚ â¡ï¸ Business + Data Layer ã®ã¿
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Business      â”‚ â¡ï¸ (åŸºæœ¬çš„ã«ä»–å±¤ã«ä¾å­˜ã—ãªã„)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Data        â”‚ â¡ï¸ Infrastructure Layer ã®ã¿
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Infrastructure  â”‚ â¡ï¸ (æœ€ä¸‹ä½å±¤ãƒ»ä»–å±¤ã«ä¾å­˜ã—ãªã„)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ” å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä¾‹

#### âŒ **æ‚ªã„ä¾‹ï¼šä¾å­˜é–¢ä¿‚é•å**

```javascript
// Infrastructure LayerãŒBusiness Layerã«ä¾å­˜ï¼ˆé•åï¼ï¼‰
class RakutenCsvParser {
    convertRow(row) {
        const data = this.parseBasicData(row);
        
        // âŒ Infrastructureå±¤ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œ
        const sectorService = new SectorService();
        data.sector = sectorService.assignSector(data);
        
        return data;
    }
}

// Business LayerãŒUI Layerã‚’çŸ¥ã£ã¦ã„ã‚‹ï¼ˆé•åï¼ï¼‰
class SectorService {
    calculateRisk(portfolio) {
        const risk = this.computeHHI(portfolio);
        
        // âŒ Businesså±¤ã§UIæ“ä½œ
        document.getElementById('riskDisplay').textContent = risk.level;
        
        return risk;
    }
}
```

#### âœ… **è‰¯ã„ä¾‹ï¼šæ­£ã—ã„ä¾å­˜é–¢ä¿‚**

```javascript
// Infrastructure Layerï¼šæŠ€è¡“çš„æ©Ÿèƒ½ã®ã¿
class RakutenCsvParser {
    convertRow(row) {
        // âœ… ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ã¿ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã—ï¼‰
        return {
            date: this.parseDate(row['ç´„å®šæ—¥']),
            name: row['éŠ˜æŸ„å'] || '',
            code: row['éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰'] || '',
            quantity: this.parseQuantity(row['æ•°é‡ï¼»æ ªï¼½'] || '0')
        };
    }
}

// Business Layerï¼šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿
class SectorService {
    calculateRisk(portfolio) {
        // âœ… è¨ˆç®—ã®ã¿ï¼ˆUIæ“ä½œãªã—ï¼‰
        const hhi = portfolio.reduce((sum, asset) => 
            sum + Math.pow(asset.percentage, 2), 0);
        
        return {
            hhi,
            level: hhi > 2500 ? 'high' : hhi > 1500 ? 'medium' : 'low'
        };
    }
}

// Application Layerï¼šèª¿æ•´å½¹
class PortfolioService {
    async updatePortfolioWithRisk(csvFile) {
        // âœ… ä¸‹ä½å±¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›
        const data = await this.csvParser.parse(csvFile);      // Infrastructure
        const withSectors = this.sectorService.assign(data);   // Business
        const withRisk = this.sectorService.calculateRisk(withSectors); // Business
        
        return { portfolio: withSectors, risk: withRisk };
    }
}

// UI Layerï¼šè¡¨ç¤ºã¨ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®ã¿
class PortfolioController {
    async importCsv(file) {
        // âœ… Application Layerã«å‡¦ç†ã‚’å§”è­²
        const result = await this.portfolioService.updatePortfolioWithRisk(file);
        
        // âœ… è¡¨ç¤ºã®ã¿
        this.view.displayPortfolio(result.portfolio);
        this.view.displayRisk(result.risk);
    }
}
```

### ğŸ›¡ï¸ ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯æ–¹æ³•

#### 1. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã®ç¢ºèª**
```javascript
// âŒ ä¸‹ä½å±¤ãŒä¸Šä½å±¤ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
// Infrastructure Layerã§Application Layerã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { CsvImportService } from '../../services/CsvImportService.js'; // é•åï¼

// âœ… ä¸Šä½å±¤ãŒä¸‹ä½å±¤ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
// Application Layerã§Infrastructure Layerã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { RakutenCsvParser } from '../infrastructure/parsers/RakutenCsvParser.js'; // æ­£ã—ã„
```

#### 2. **newæ¼”ç®—å­ã®ç¢ºèª**
```javascript
// âŒ ä¸‹ä½å±¤ã§ä¸Šä½å±¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
class SectorService {
    updateUI(data) {
        const controller = new DashboardController(); // é•åï¼
        controller.update(data);
    }
}

// âœ… ä¸Šä½å±¤ã§ä¸‹ä½å±¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
class DashboardController {
    constructor() {
        this.sectorService = new SectorService(); // æ­£ã—ã„
    }
}
```

#### 3. **ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã®ç¢ºèª**
```javascript
// âŒ å¾ªç’°ä¾å­˜
class ServiceA {
    method() {
        const serviceB = new ServiceB();
        serviceB.callServiceA(); // ServiceBå†…ã§ServiceAã‚’å‘¼ã¶
    }
}

class ServiceB {
    callServiceA() {
        const serviceA = new ServiceA(); // å¾ªç’°ä¾å­˜ï¼
        serviceA.method();
    }
}
```

---

## 6. å®Ÿè·µæ¼”ç¿’

### ğŸ¯ æ¼”ç¿’1ï¼šå±¤ã®è­˜åˆ¥

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã©ã®å±¤ã«å±ã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ

```javascript
// A. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
function handlePortfolioClick(event) {
    const portfolioId = event.target.dataset.portfolioId;
    showPortfolioDetails(portfolioId);
}

// B. æŠ•è³‡ãƒªã‚¹ã‚¯ã®HHIæŒ‡æ•°ã‚’è¨ˆç®—
function calculateHHIIndex(allocations) {
    return allocations.reduce((sum, allocation) => {
        return sum + Math.pow(allocation.percentage, 2);
    }, 0);
}

// C. LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
function loadPortfolioData(portfolioId) {
    const key = `portfolio_${portfolioId}`;
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : null;
}

// D. æ¥½å¤©è¨¼åˆ¸CSVã®1è¡Œã‚’è§£æ
function parseRakutenCsvRow(csvRow) {
    return {
        date: csvRow['ç´„å®šæ—¥'],
        stock: csvRow['éŠ˜æŸ„å'],
        quantity: parseInt(csvRow['æ•°é‡ï¼»æ ªï¼½'])
    };
}

// E. è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªåˆ†æã‚’å®Ÿè¡Œ
async function analyzePortfolio(csvFile) {
    const data = await csvParser.parse(csvFile);
    const sectors = sectorService.assign(data);
    const risk = riskService.calculate(sectors);
    return { data, sectors, risk };
}
```

<details>
<summary>ğŸ” è§£ç­”ã‚’è¦‹ã‚‹</summary>

- **A. Presentation Layer** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- **B. Business Layer** - æŠ•è³‡ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆHHIè¨ˆç®—ï¼‰
- **C. Data Layer** - ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ãƒ»å–å¾—
- **D. Infrastructure Layer** - å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®è§£æ
- **E. Application Layer** - è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®èª¿æ•´

</details>

### ğŸ¯ æ¼”ç¿’2ï¼šä¾å­˜é–¢ä¿‚ã®ä¿®æ­£

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ä¾å­˜é–¢ä¿‚é•åã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ï¼š

```javascript
// å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
class CsvParser {
    parseFile(file) {
        const data = this.extractData(file);
        
        // ğŸš¨ Infrastructure Layerã§Business Layerã‚’ä½¿ç”¨
        const sectorService = new SectorService();
        data.forEach(row => {
            row.sector = sectorService.assignSector(row);
        });
        
        // ğŸš¨ Infrastructure Layerã§Data Layerã‚’ä½¿ç”¨
        const repository = new AssetRepository();
        repository.saveAll(data);
        
        return data;
    }
}
```

<details>
<summary>ğŸ” è§£ç­”ã‚’è¦‹ã‚‹</summary>

```javascript
// ä¿®æ­£ç‰ˆï¼šä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãåˆ†é›¢

// Infrastructure Layerï¼šè§£æã®ã¿
class CsvParser {
    parseFile(file) {
        // âœ… ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã®ã¿ï¼ˆä»–å±¤ã«ä¾å­˜ã—ãªã„ï¼‰
        return this.extractData(file);
    }
}

// Application Layerï¼šèª¿æ•´å½¹
class CsvImportService {
    constructor() {
        this.csvParser = new CsvParser();       // Infrastructure
        this.sectorService = new SectorService(); // Business
        this.repository = new AssetRepository();  // Data
    }
    
    async importCsv(file) {
        // âœ… ä¸Šä½å±¤ãŒä¸‹ä½å±¤ã‚’çµ„ã¿åˆã‚ã›
        const data = this.csvParser.parseFile(file);
        
        const withSectors = data.map(row => 
            this.sectorService.assignSector(row)
        );
        
        await this.repository.saveAll(withSectors);
        
        return withSectors;
    }
}
```

</details>

### ğŸ¯ æ¼”ç¿’3ï¼šæ–°æ©Ÿèƒ½ã®è¨­è¨ˆ

ã€Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã€æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å ´åˆã€ã©ã®å±¤ã«ã©ã®è²¬å‹™ã‚’é…ç½®ã—ã¾ã™ã‹ï¼Ÿ

**è¦ä»¶:**
- éå»ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¹´ç‡ãƒªã‚¿ãƒ¼ãƒ³ã‚’è¨ˆç®—
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆæ—¥çµŒå¹³å‡ã€S&P500ï¼‰ã¨æ¯”è¼ƒ
- çµæœã‚’ã‚°ãƒ©ãƒ•ã§è¡¨ç¤º

<details>
<summary>ğŸ” è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>

```javascript
// Infrastructure Layerï¼šå¤–éƒ¨ãƒ‡ãƒ¼ã‚¿å–å¾—
class BenchmarkDataProvider {
    async fetchNikkeiData(startDate, endDate) {
        // å¤–éƒ¨APIã‹ã‚‰æ—¥çµŒå¹³å‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    }
    
    async fetchSP500Data(startDate, endDate) {
        // å¤–éƒ¨APIã‹ã‚‰S&P500ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    }
}

// Business Layerï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆç®—
class PerformanceAnalyzer {
    calculateAnnualReturn(priceData) {
        // å¹´ç‡ãƒªã‚¿ãƒ¼ãƒ³è¨ˆç®—ã®æŠ•è³‡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    }
    
    compareWithBenchmark(portfolioReturn, benchmarkReturn) {
        // ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¯”è¼ƒã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    }
    
    calculateVolatility(priceData) {
        // ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£è¨ˆç®—
    }
}

// Data Layerï¼šå±¥æ­´ãƒ‡ãƒ¼ã‚¿ç®¡ç†
class PerformanceRepository {
    savePerformanceHistory(data) {
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å±¥æ­´ã®ä¿å­˜
    }
    
    getPortfolioHistory(portfolioId, period) {
        // éå»ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
    }
}

// Application Layerï¼šæ©Ÿèƒ½ã®ç·¨æˆ
class PerformanceService {
    constructor() {
        this.analyzer = new PerformanceAnalyzer();
        this.dataProvider = new BenchmarkDataProvider();
        this.repository = new PerformanceRepository();
    }
    
    async analyzePerformance(portfolioId, period) {
        // 1. ãƒ‡ãƒ¼ã‚¿å–å¾—
        const portfolioData = await this.repository.getPortfolioHistory(portfolioId, period);
        const benchmarkData = await this.dataProvider.fetchNikkeiData(period.start, period.end);
        
        // 2. è¨ˆç®—
        const portfolioReturn = this.analyzer.calculateAnnualReturn(portfolioData);
        const benchmarkReturn = this.analyzer.calculateAnnualReturn(benchmarkData);
        
        // 3. æ¯”è¼ƒ
        const comparison = this.analyzer.compareWithBenchmark(portfolioReturn, benchmarkReturn);
        
        return { portfolioReturn, benchmarkReturn, comparison };
    }
}

// Presentation Layerï¼šã‚°ãƒ©ãƒ•è¡¨ç¤º
class PerformanceChart {
    displayPerformanceComparison(data) {
        // Chart.jsã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã‚’æç”»
    }
}

class PerformanceController {
    async showPerformanceAnalysis(portfolioId) {
        const result = await this.performanceService.analyzePerformance(portfolioId, { period: '1year' });
        this.chart.displayPerformanceComparison(result);
    }
}
```

</details>

---

## 7. ã‚ˆãã‚ã‚‹é–“é•ã„ã¨å¯¾ç­–

### ğŸš¨ é–“é•ã„1ï¼šç¥ã‚¯ãƒ©ã‚¹ï¼ˆGod Classï¼‰

**å•é¡Œ:**
```javascript
// âŒ ã™ã¹ã¦ã‚’1ã¤ã®ã‚¯ãƒ©ã‚¹ã§å‡¦ç†
class PortfolioManager {
    // UIå‡¦ç†
    displayPortfolio() { /* ... */ }
    handleClick() { /* ... */ }
    
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    calculateRisk() { /* ... */ }
    assignSectors() { /* ... */ }
    
    // ãƒ‡ãƒ¼ã‚¿æ“ä½œ
    saveData() { /* ... */ }
    loadData() { /* ... */ }
    
    // å¤–éƒ¨é€£æº
    parseCsv() { /* ... */ }
    callAPI() { /* ... */ }
}
```

**è§£æ±ºç­–:**
```javascript
// âœ… è²¬å‹™ã‚’åˆ†é›¢
class PortfolioController {        // Presentation
    displayPortfolio() { /* ... */ }
}

class PortfolioAnalyzer {          // Business
    calculateRisk() { /* ... */ }
}

class PortfolioRepository {        // Data
    saveData() { /* ... */ }
}

class CsvParser {                  // Infrastructure
    parseCsv() { /* ... */ }
}
```

### ğŸš¨ é–“é•ã„2ï¼šå¾ªç’°ä¾å­˜

**å•é¡Œ:**
```javascript
// âŒ ServiceAã¨ServiceBãŒäº’ã„ã«ä¾å­˜
class ServiceA {
    constructor() {
        this.serviceB = new ServiceB(); // ServiceBã‚’ä¾å­˜
    }
    
    methodA() {
        return this.serviceB.methodB();
    }
}

class ServiceB {
    constructor() {
        this.serviceA = new ServiceA(); // ServiceAã‚’ä¾å­˜ï¼ˆå¾ªç’°ï¼ï¼‰
    }
    
    methodB() {
        return this.serviceA.methodA();
    }
}
```

**è§£æ±ºç­–:**
```javascript
// âœ… å…±é€šæ©Ÿèƒ½ã‚’ä¸‹ä½å±¤ã«æŠ½å‡º
class SharedService {              // ä¸‹ä½å±¤
    sharedMethod() { /* ... */ }
}

class ServiceA {                   // ä¸Šä½å±¤
    constructor() {
        this.sharedService = new SharedService();
    }
    
    methodA() {
        return this.sharedService.sharedMethod();
    }
}

class ServiceB {                   // ä¸Šä½å±¤
    constructor() {
        this.sharedService = new SharedService();
    }
    
    methodB() {
        return this.sharedService.sharedMethod();
    }
}
```

### ğŸš¨ é–“é•ã„3ï¼šå±¤ã®è²¬å‹™é•å

**å•é¡Œ:**
```javascript
// âŒ Business Layerã§UIæ“ä½œ
class RiskCalculator {
    calculateRisk(portfolio) {
        const risk = this.computeHHI(portfolio);
        
        // Business Layerã§DOMæ“ä½œï¼ˆé•åï¼ï¼‰
        document.getElementById('risk-display').textContent = risk.level;
        alert(`ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${risk.level}`);
        
        return risk;
    }
}
```

**è§£æ±ºç­–:**
```javascript
// âœ… Business Layerã¯è¨ˆç®—ã®ã¿
class RiskCalculator {
    calculateRisk(portfolio) {
        const hhi = this.computeHHI(portfolio);
        
        // è¨ˆç®—çµæœã®ã¿è¿”å´ï¼ˆUIæ“ä½œãªã—ï¼‰
        return {
            hhi,
            level: this.determineRiskLevel(hhi),
            recommendation: this.getRecommendation(hhi)
        };
    }
}

// âœ… Presentation Layerã§è¡¨ç¤º
class RiskDisplayController {
    updateRiskDisplay(risk) {
        document.getElementById('risk-display').textContent = risk.level;
        
        if (risk.level === 'high') {
            this.showRiskWarning(risk.recommendation);
        }
    }
}
```

### ğŸš¨ é–“é•ã„4ï¼šç¡¬ç›´ã—ãŸè¨­è¨ˆ

**å•é¡Œ:**
```javascript
// âŒ å…·è±¡ã‚¯ãƒ©ã‚¹ã«ç›´æ¥ä¾å­˜
class PortfolioService {
    constructor() {
        this.storage = new LocalStorageManager(); // å…·è±¡ã‚¯ãƒ©ã‚¹ã«ä¾å­˜
    }
    
    save(data) {
        return this.storage.save(data); // LocalStorageå°‚ç”¨
    }
}
```

**è§£æ±ºç­–:**
```javascript
// âœ… æŠ½è±¡ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã«ä¾å­˜
interface StorageInterface {
    save(data): boolean;
    load(key): any;
}

class LocalStorageManager implements StorageInterface {
    save(data) { /* LocalStorageå®Ÿè£… */ }
    load(key) { /* LocalStorageå®Ÿè£… */ }
}

class IndexedDBManager implements StorageInterface {
    save(data) { /* IndexedDBå®Ÿè£… */ }
    load(key) { /* IndexedDBå®Ÿè£… */ }
}

class PortfolioService {
    constructor(storage: StorageInterface) {
        this.storage = storage; // æŠ½è±¡ã«ä¾å­˜
    }
    
    save(data) {
        return this.storage.save(data); // å®Ÿè£…ã‚’çŸ¥ã‚‰ãªã„
    }
}

// ä½¿ç”¨æ™‚ã«å…·è±¡ã‚¯ãƒ©ã‚¹ã‚’æ³¨å…¥
const portfolioService = new PortfolioService(new LocalStorageManager());
```

---

## 8. ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯

### ğŸ—ï¸ SOLIDåŸå‰‡ã¨ã®é–¢ä¿‚

ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€SOLIDåŸå‰‡ã‚’å®Ÿè·µã™ã‚‹æ‰‹æ³•ã§ã‚‚ã‚ã‚Šã¾ã™ï¼š

#### **S - Single Responsibility Principleï¼ˆå˜ä¸€è²¬å‹™åŸå‰‡ï¼‰**
```javascript
// âœ… å„å±¤ãŒå˜ä¸€ã®è²¬å‹™ã‚’æŒã¤
class CsvParser {          // è²¬å‹™ï¼šCSVè§£æã®ã¿
class SectorService {      // è²¬å‹™ï¼šã‚»ã‚¯ã‚¿ãƒ¼åˆ†æã®ã¿
class DataRepository {     // è²¬å‹™ï¼šãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®ã¿
```

#### **O - Open/Closed Principleï¼ˆé–‹æ”¾é–‰é–åŸå‰‡ï¼‰**
```javascript
// âœ… æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã¯æ‹¡å¼µï¼ˆæ–°ã‚¯ãƒ©ã‚¹è¿½åŠ ï¼‰ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰å¤‰æ›´ä¸è¦
class NewCsvFormat extends CsvParser {
    // æ—¢å­˜ã®CsvParserã‚’å¤‰æ›´ã›ãšã€æ–°å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
}
```

#### **L - Liskov Substitution Principleï¼ˆãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡ï¼‰**
```javascript
// âœ… åŒä¸€å±¤ã®ç•°ãªã‚‹å®Ÿè£…ã‚’ç½®æ›å¯èƒ½
const storage1 = new LocalStorageRepository();
const storage2 = new IndexedDBRepository();
// ã©ã¡ã‚‰ã‚‚åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ä½¿ç”¨å¯èƒ½
```

#### **I - Interface Segregation Principleï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢åŸå‰‡ï¼‰**
```javascript
// âœ… å„å±¤ãŒå¿…è¦ãªæ©Ÿèƒ½ã®ã¿ã‚’è¦æ±‚
interface CsvParserInterface {
    parse(file): TransactionData[];  // å¿…è¦æœ€å°é™
}
```

#### **D - Dependency Inversion Principleï¼ˆä¾å­˜æ€§é€†è»¢åŸå‰‡ï¼‰**
```javascript
// âœ… ä¸Šä½å±¤ã¯æŠ½è±¡ã«ä¾å­˜ã€å…·è±¡ã«ä¾å­˜ã—ãªã„
class PortfolioService {
    constructor(parser: CsvParserInterface) { // æŠ½è±¡ã«ä¾å­˜
        this.parser = parser;
    }
}
```

### ğŸ”„ ä»–ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ¯”è¼ƒ

#### **MVC vs ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**

```
MVCï¼ˆModel-View-Controllerï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  View   â”‚â—„â”€â”€â–ºâ”‚Controllerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â–²             â”‚
      â”‚             â–¼
      â””â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  Model  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Presentation â”‚ â† MVCã®View + Controller
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Application  â”‚ â† æ¥­å‹™ãƒ•ãƒ­ãƒ¼èª¿æ•´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Business   â”‚ â† MVCã®Modelï¼ˆä¸€éƒ¨ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Data     â”‚ â† MVCã®Modelï¼ˆä¸€éƒ¨ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Infrastructureâ”‚ â† æŠ€è¡“åŸºç›¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Clean Architecture**
```javascript
// Uncle Bobï¼ˆRobert C. Martinï¼‰ã®Clean Architecture
// ä¾å­˜é–¢ä¿‚ãŒå†…å´ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ã«å‘ã‹ã†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        UI/Web/Framework         â”‚ â† Framework & Drivers
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Controllers/Presenters      â”‚ â† Interface Adapters
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Use Cases                â”‚ â† Application Business Rules
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Entities                â”‚ â† Enterprise Business Rules
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### **å±¤ã”ã¨ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•**

```javascript
// Infrastructure Layerï¼šæŠ€è¡“çš„æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
describe('RakutenCsvParser', () => {
    it('should parse JP stock CSV correctly', async () => {
        const parser = new RakutenCsvParser();
        const mockFile = createMockCsvFile('JP stock data');
        
        const result = await parser.parseCsvFile(mockFile, 'JP');
        
        expect(result.success).toBe(true);
        expect(result.data[0].name).toBe('ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š');
    });
});

// Business Layerï¼šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
describe('SectorService', () => {
    it('should calculate HHI correctly', () => {
        const service = new SectorService();
        const allocation = [
            { sector: 'Technology', percentage: 60 },
            { sector: 'Finance', percentage: 40 }
        ];
        
        const risk = service.calculateConcentrationRisk(allocation);
        
        expect(risk.hhi).toBe(5200); // 60Â² + 40Â² = 3600 + 1600
        expect(risk.riskLevel).toBe('é«˜');
    });
});

// Application Layerï¼šçµ±åˆãƒ†ã‚¹ãƒˆ
describe('CsvImportService', () => {
    it('should import CSV with sector assignment', async () => {
        const mockRepository = {
            getAllAssets: jest.fn().mockResolvedValue([]),
            addAsset: jest.fn().mockResolvedValue({ id: 'test_123' })
        };
        
        const service = new CsvImportService({ assetRepository: mockRepository });
        const transactions = [{ symbol: 'AAPL', name: 'Apple Inc.' }];
        
        const result = await service.importTransactions(transactions);
        
        expect(result.imported).toBe(1);
        expect(mockRepository.addAsset).toHaveBeenCalled();
    });
});
```

### ğŸš€ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ç™ºå±•

```javascript
// ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ â†’ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç§»è¡Œä¾‹

// å¾“æ¥ï¼š1ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®å±¤
class PortfolioService {
    constructor() {
        this.csvParser = new RakutenCsvParser();      // Infrastructure
        this.sectorService = new SectorService();      // Business
        this.repository = new PortfolioRepository();   // Data
    }
}

// ç§»è¡Œå¾Œï¼šç‹¬ç«‹ã—ãŸãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹
class PortfolioService {
    constructor() {
        this.csvParserAPI = new CsvParserMicroservice('http://csv-parser-service');
        this.sectorAPI = new SectorMicroservice('http://sector-service');
        this.repository = new PortfolioRepository(); // ä¸€éƒ¨ã¯æ®‹ã‚‹
    }
    
    async importCsv(file) {
        const parsed = await this.csvParserAPI.parse(file);      // å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
        const withSectors = await this.sectorAPI.assignSectors(parsed); // å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
        return await this.repository.save(withSectors);         // ãƒ­ãƒ¼ã‚«ãƒ«
    }
}
```

---

## ğŸ¯ ã¾ã¨ã‚

### ğŸ“š å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ

1. **è²¬å‹™ã®åˆ†é›¢**ï¼šå„å±¤ãŒæ˜ç¢ºãªå½¹å‰²ã‚’æŒã¤
2. **ä¾å­˜é–¢ä¿‚ç®¡ç†**ï¼šä¸Šä½å±¤â†’ä¸‹ä½å±¤ã®ä¸€æ–¹å‘ã®ã¿
3. **æŠ½è±¡åŒ–**ï¼šæŠ€è¡“çš„è©³ç´°ã‚’éš è”½ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­
4. **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**ï¼šå„å±¤ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
5. **ä¿å®ˆæ€§**ï¼šå¤‰æ›´ã®å½±éŸ¿ã‚’å±€æ‰€åŒ–

### ğŸ› ï¸ å®Ÿè·µã§ã®æ´»ç”¨

- **è¨­è¨ˆæ™‚**ï¼šæ–°æ©Ÿèƒ½ã‚’ã©ã®å±¤ã«é…ç½®ã™ã‚‹ã‹åˆ¤æ–­
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚**ï¼šä¾å­˜é–¢ä¿‚é•åãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯
- **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚**ï¼šè²¬å‹™ã®é©åˆ‡ãªåˆ†é›¢
- **ãƒ†ã‚¹ãƒˆæ™‚**ï¼šå±¤ã”ã¨ã®ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆ

### ğŸ”„ ç¶™ç¶šçš„ãªæ”¹å–„

1. **å®šæœŸçš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ“ãƒ¥ãƒ¼**
2. **ä¾å­˜é–¢ä¿‚ã®å¯è¦–åŒ–**
3. **æ–°æŠ€è¡“ã¨ã®é©å¿œ**
4. **ãƒãƒ¼ãƒ å†…ã§ã®çŸ¥è­˜å…±æœ‰**

---

**å­¦ç¿’å®Œäº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼** ğŸ‰

ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã«ãŠã‘ã‚‹é‡è¦ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ä»Šå›ã®æŠ•è³‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–‹ç™ºã‚’é€šã˜ã¦ã€ç†è«–ã ã‘ã§ãªãå®Ÿè·µçš„ãªç†è§£ã‚‚æ·±ã¾ã£ãŸã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®çŸ¥è­˜ã¯ã€ä»Šå¾Œã‚ˆã‚Šå¤§è¦æ¨¡ã§è¤‡é›‘ãªã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆã™ã‚‹éš›ã«ã‚‚æ´»ç”¨ã§ãã¾ã™ã€‚ãœã²ç¶™ç¶šçš„ã«å®Ÿè·µã‚’ç©ã¿é‡ã­ã¦ã€ã•ã‚‰ãªã‚‹ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¦ãã ã•ã„ï¼