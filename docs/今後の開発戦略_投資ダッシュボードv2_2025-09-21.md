# 投資ダッシュボード v2 - 今後の開発戦略

**策定日**: 2025年9月21日  
**対象期間**: 2025年10月〜2026年3月（6ヶ月間）  
**目標**: 実用的な投資管理ツールの完成  
**アーキテクチャ**: レイヤードアーキテクチャ v3.0（Canonical Transactions）

---

## 📊 現在の開発状況（v3台帳へ移行完了 / Phase 1 完了）

### ✅ 完了済み機能

| 機能領域 | 実装状況 | 品質 | 備考 |
|----------|----------|------|------|
| **基盤アーキテクチャ** | ✅ 100% | 高 | レイヤードアーキテクチャ確立 |
| **ナビゲーションシステム** | ✅ 100% | 高 | SPA風ルーティング実装 |
| **RakutenCsvParser v3** | ✅ 100% | 高 | v3専用・TransactionEntity出力（Shift-JIS対応） |
| **TransactionRepository** | ✅ 100% | 高 | append-only台帳、指紋デデュープ |
| **ExposureRepository(最小)** | ✅ 100% | 中 | セクター/地域の重み取得（手動/デフォルト） |
| **PortfolioAggregator(v3拡張)** | ✅ 100% | 中 | entities→positions、exposure合成 |
| **PortfolioAnalysisService** | ✅ 100% | 高 | 台帳→positions→exposure ユースケース |
| **CsvImportService(v3接続)** | ✅ 100% | 高 | プレビュー射影・一括保存（dryRun対応） |
| **統合テスト環境** | ✅ 100% | 中 | localhost:3000環境 |

### 🔨 部分実装済み機能

| 機能領域 | 進捗 | 課題 |
|----------|------|------|
| **DataStoreManager** | 70% | LocalStorage基盤のみ、高度なクエリ未実装 |
| **UI画面表示** | 65% | ダッシュボード配分（セクター）・DBテーブルをv3で表示済み |
| **エラーハンドリング** | 60% | 各層で基本実装、ユーザビリティ改善要 |

> 参考: 詳細な移行ログは `docs/archive/作業ログ_2025-09-21_v3データ統合移行.md` を参照。

### ✅ Phase 1 完了の要点
- v3 canonical transactions による台帳正規化が完了
- 取込→正規化→保存→positions/exposure→UI表示の最短経路を接続
- 受け入れチェック（符号/デデュープ/円フロー）の自動サマリーを導入

---

## 🚀 Phase 2.0: コア機能完成（2025年10月-11月）

### 🎯 Phase 2.0 目標
**「日常的に使える投資ダッシュボードの完成」**

### 📋 Phase 2.0 タスク一覧

#### 2.1 PortfolioAggregator統合（v3）【優先度: 最高】
```
期間: 2025年10月第1週-第2週
担当層: Business Layer (src/business/analysis/)
```

- **機能**:
  - TransactionEntity[] → positions（数量ネット・加重平均原価・コスト）
  - exposure 合成（セクター/地域、重み×値）
  - パフォーマンス分析（総額・損益・比率）

- **具体的タスク**:
  - [x] v3 entities→positions 集約（実装済）
  - [x] exposure 合成ロジック（実装済）
  - [ ] リアルタイム損益計算エンジン（評価額ソースの導入）
  - [ ] 配当・分配金管理の取り込み（dividend/interest）

#### 2.2 ダッシュボード画面実装 【優先度: 高】
```
期間: 2025年10月第3週-第4週  
担当層: Presentation Layer (src/ui/)
```

- **機能**:
  - ポートフォリオサマリー表示
  - セクター/地域配分チャート（v3 exposure）
  - 資産推移グラフ
  - アラート・通知機能

- **具体的タスク**:
  - [x] セクター配分（ドーナツ）に v3 exposure を接続
  - [ ] 地域配分の追加表示
  - [ ] 投資パフォーマンス時系列（台帳ベース集計）
  - [ ] リスク指標の視覚化

#### 2.3 データ永続化強化 【優先度: 中】
```
期間: 2025年11月第1週-第2週
担当層: Data Layer (src/data/)
```

- **機能**:
  - 高度なLocalStorage/IndexedDB クエリ
  - データ整合性チェック
  - バックアップ・リストア機能

- **具体的タスク**:
  - [ ] IndexedDB対応（台帳の検索・期間抽出を高速化）
  - [ ] データマイグレーション機能（v2→v3完全移行のクリーニング）
  - [ ] 自動バックアップ機能
  - [ ] データ整合性チェック
  - [ ] 大容量データ処理最適化

---

## 🔮 Phase 3.0: 高度機能追加（2025年12月-2026年1月）

### 🎯 Phase 3.0 目標
**「プロレベルの分析機能を提供」**

#### 3.1 外部API連携
- **株価API統合**: Yahoo Finance / Alpha Vantage
- **為替レートAPI**: リアルタイム通貨換算
- **配当情報API**: 配当予想・実績データ

#### 3.2 高度分析機能
- **VaR（Value at Risk）計算**: リスク指標
- **シャープレシオ計算**: リスク調整後リターン
- **相関分析**: 銘柄間・セクター間相関
- **ベンチマーク比較**: TOPIX・S&P500との比較

#### 3.3 アラート・通知システム
- **価格アラート**: 指定価格到達通知
- **リバランス推奨**: ポートフォリオ調整提案
- **配当通知**: 配当受取日リマインダー

---

## ⚡ Phase 4.0: UX/パフォーマンス最適化（2026年2月-3月）

### 🎯 Phase 4.0 目標
**「商用レベルの品質とパフォーマンス実現」**

#### 4.1 パフォーマンス最適化
- **レンダリング最適化**: 大量データの高速表示
- **メモリ効率化**: ガベージコレクション対策
- **ローディング高速化**: プリロード・キャッシュ戦略

#### 4.2 UX改善
- **直感的UI**: ユーザビリティテスト実施
- **モバイル対応**: PWA化・タッチ操作最適化
- **アクセシビリティ**: WCAG 2.1準拠

#### 4.3 品質向上
- **包括的テスト**: 単体・結合・E2Eテスト
- **エラーハンドリング**: 想定外エラーの完全対応
- **セキュリティ強化**: XSS・CSRF対策

---

## 🏗️ 技術戦略・アーキテクチャ方針

### 📚 学習・技術習得計画

#### レイヤードアーキテクチャの深化
```
10月: DDD（Domain Driven Design）学習
11月: CQRS（Command Query Responsibility Segregation）適用
12月: Clean Architecture原則の適用
```

#### 新技術導入検討
```
- TypeScript移行: 型安全性向上（Phase 3.0で検討）
- Web Workers: 大量データ処理の並列化
- Service Worker: オフライン対応・キャッシュ戦略
- GraphQL: 外部API統合の効率化
```

### 🔧 開発環境・ツール強化

#### 開発効率化
- **ESLint + Prettier**: コード品質統一
- **Jest**: 単体テスト自動化
- **Playwright**: E2Eテスト自動化
- **GitHub Actions**: CI/CD パイプライン

#### 監視・デバッグ
- **Performance API**: パフォーマンス監視
- **Error Boundary**: エラー追跡
- **Analytics**: ユーザー行動分析

---

## 📅 具体的マイルストーン

### 2025年10月マイルストーン
```
✅ 10/7:  PortfolioAggregator(v3) 主要機能（positions/exposure）
✅ 10/14: ダッシュボード配分チャート v3接続
✅ 10/21: Chart.js チューニング/追加グラフ
✅ 10/28: 配分（地域）・サマリー拡充
```

### 2025年11月マイルストーン
```
✅ 11/7:  データ永続化強化完了
✅ 11/14: リアルタイム損益計算完了
✅ 11/21: 通貨換算機能完了
✅ 11/28: Phase 2.0 完全テスト完了
```

### 2025年12月マイルストーン
```
✅ 12/7:  外部API連携基盤完了
✅ 12/14: 株価・為替API統合完了
✅ 12/21: 高度分析機能実装完了
✅ 12/28: Phase 3.0 リリース判定
```

---

## 🎯 成功指標・KPI

### 技術的KPI
- **テストカバレッジ**: 80%以上
- **パフォーマンス**: 初期ロード3秒以内
- **エラー率**: 1%未満
- **レスポンシブ対応**: モバイル・タブレット完全対応

### 機能的KPI
- **CSV解析成功率**: 99%以上（v3 canonical で形式差異吸収）
- **データ整合性**: 金額計算誤差0.01%以内
- **セクター分類精度**: 95%以上（exposureマスタ整備）
- **ユーザビリティ**: 直感的操作実現

### 学習・成長KPI
- **アーキテクチャ理解**: Clean Architecture完全理解
- **設計パターン**: GOF + DDD パターン習得
- **パフォーマンス**: 大規模データ処理最適化スキル
- **テスト**: TDD/BDD手法の実践習得

---

## ⚠️ リスク管理・対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| **外部API制限** | 高 | フォールバック機能・キャッシュ戦略 |
| **大容量データ性能** | 中 | Web Workers・仮想化導入 |
| **ブラウザ互換性** | 中 | Polyfill・Progressive Enhancement |
| **セキュリティ脆弱性** | 高 | 定期セキュリティ監査・更新 |

### 開発リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| **スコープクリープ** | 中 | MVP優先・機能凍結期間設定 |
| **技術的負債蓄積** | 中 | 定期リファクタリング・コードレビュー |
| **学習コスト超過** | 低 | 段階的学習・実践ベース手法 |

---

## 🔄 継続的改善・運用計画

### 週次レビュー
- **月曜**: 先週の振り返り・今週目標設定
- **金曜**: 進捗確認・課題整理・学習成果記録

### 月次レビュー
- **アーキテクチャ設計レビュー**: 設計品質向上
- **パフォーマンス測定**: ボトルネック特定・改善
- **ユーザビリティテスト**: 実際の使いやすさ確認

### 四半期レビュー
- **技術選択見直し**: 新技術導入判断
- **ロードマップ調整**: 市場動向・技術トレンド反映
- **品質指標評価**: KPI達成状況分析

---

## 💡 将来構想（2026年4月以降）

### 🌟 長期ビジョン
**「個人投資家のためのオールインワン投資管理プラットフォーム」**

### 拡張機能構想
- **ポートフォリオ最適化AI**: 機械学習による推奨配分
- **税務計算支援**: 確定申告書類自動生成
- **投資教育コンテンツ**: 初心者向けガイド統合
- **ソーシャル機能**: 投資家コミュニティ・情報共有
- **モバイルアプリ**: React Native / Flutter版

### オープンソース化検討
- **GitHub公開**: MIT Licenseでの提供
- **コミュニティ形成**: 開発者・ユーザーコミュニティ
- **プラグインシステム**: サードパーティ拡張機能

---

## 📞 サポート・協力体制

### 学習リソース
- **書籍**: 『Clean Architecture』『Domain-Driven Design』
- **オンラインコース**: Udemy・Coursera・Pluralsight
- **コミュニティ**: Stack Overflow・Reddit・Qiita

### メンター・レビュー
- **コードレビュー**: GitHub PR・コミット品質向上
- **アーキテクチャ相談**: 設計判断・ベストプラクティス
- **キャリア相談**: 技術スキル向上・学習方針

---

**文書作成者**: Codex CLI（自動更新）  
**承認者**: 投資ダッシュボード開発チーム  
**最終更新**: 2025年9月21日（v3台帳移行反映）  
**次回見直し**: 2025年10月21日

---

> 💡 **重要**: この戦略文書は生きた文書です。技術の進歩、ユーザーフィードバック、市場環境の変化に応じて定期的に更新していきます。常に実用的で価値のある投資管理ツールの実現を目指します。
